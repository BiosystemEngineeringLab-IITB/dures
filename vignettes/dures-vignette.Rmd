---
title: "Demonstration of the package dures"
author: "Shayantan Banerjee"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demonstration of the package dures}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
options(repos = c(CRAN = "https://cloud.r-project.org/"))

# Suppress title check if necessary
options(rmarkdown.html_vignette.check_title = FALSE)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The **Denoising Using Replicate Spectra (DuReS)** package requires the following input parameters:

- A folder path to store all the data and analysis results.
- A folder named `mzml_files/` within the above folder path, containing files in the mzML format.
- A features file containing a list of MS/MS features derived from standard untargeted metabolomics analysis software. This file must satisfy one of the following requirements:
  - **Option 1**: A single file named `feature_list.txt` with columns “ID”, “mz”, and “RT”. In this case, a fixed but customizable RT and mz tolerance will be used to extract the MS/MS spectra.
  - **Option 2**: Both:
    - A `feature_list.txt` file in the format described above, and
    - A RT tolerance file named `Sample-and_feature-wise-RT-tolerance.txt` containing custom RT tolerances for each sample. For example:
      - If there are two samples (`sample_1` and `sample_2`), the `Sample-and_feature-wise-RT-tolerance.txt` file should have the same number of rows as `feature_list.txt`.
      - The column names should be formatted as `RT_min_sample_1`, `RT_min_sample_2`, `RT_max_sample_1`, and `RT_max_sample_2`.


## Test Datasets

All the test datasets used in this vignette are hosted at [https://zenodo.org/records/13778168](https://zenodo.org/records/13778168). Users need to download the file and unzip the folder contents on their local system.

- The `test_1` folder contains a folder named `mzml_files/` and two files: `Sample-and-feature-wise-RT-tolerance.txt` and `feature_list.txt`. The `feature_list.txt` file has three columns: "ID", "mz", and "RT". The additional file `Sample-and-feature-wise-RT-tolerance.txt` contains the sample-wise RT tolerances for all features. The number of rows in both files is the same, while the `Sample-and-feature-wise-RT-tolerance.txt` file has twice as many columns as `feature_list.txt`, with `RT_min_` and `RT_max_` appended to every sample name.
  
- The `test_2` and `test_3` folders each contain a folder named `mzml_files/` and a file named `feature_list.txt`.

## Install the package and dependencies
```{r initial-setup}
# Dependencies
install.packages("BiocManager", quiet = TRUE)
BiocManager::install(c("Spectra", "S4Vectors", "mzR"), quiet = TRUE)

if (!requireNamespace("devtools", quietly = TRUE)) {
  install.packages("devtools", quiet = TRUE)
}
library(devtools)
library(Spectra)
library(S4Vectors)
library(mzR)

devtools::install_github("BiosystemEngineeringLab-IITB/dures")
library(dures)
```

## First Test Example

```{r}
# Define the path to the test_1 folder (replace with the actual path on your system)
folder_path <- "~/Desktop/test_package_dures/test_1/"
# Check if the directory exists
if (!dir.exists(folder_path)) {
  stop("The directory 'test_1' does not exist. Please modify the path to the actual location of the 'test_1' folder.")
}
l1 = preprocess(folder_path = folder_path, tol_mz = 5, tol_rt = 0.1)
```

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
